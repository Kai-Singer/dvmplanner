<!DOCTYPE html>
<html lang="de">
{% load static %}
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="{% static 'imgs/logo_favicon.png' %}">
  <link rel="stylesheet" href="{% static 'styles/main.css' %}">
  <link rel="stylesheet" href="{% static 'styles/dashboard.css' %}">
  <script>
    const staticMenuIcon = "{% static 'imgs/menu_icon.png' %}";
    const staticCloseIcon = "{% static 'imgs/close_icon.png' %}";
  </script>
  <script src="{% static 'scripts/main.js' %}" defer></script>
  <script src="{% static 'scripts/dashboard.js' %}" defer></script>
  <title>Dashboard - DVM Planner</title>
</head>
<body>
  <!-- FLOATING WINDOWS -->
  <div class="floating_background" id="floating_background" onclick="closeFloatingWindows()"></div>
  <!-- DELETE REPORT -->
  <div class="floating_container" id="floating_window_delete_entry">
    <div class="floating_window">
      <div class="floating_header">
        <h1>Zeiteintrag löschen</h1>
        <div class="floating_close_button" onclick="closeFloatingWindows()">
          <img src="{% static 'imgs/close_icon.png' %}" alt="Close window" draggable="false">
        </div>
      </div>
      <form action="" method="post">
        {% csrf_token %}
        <input type="hidden" name="context" value="delete_entry">
        <input type="hidden" id="floating_window_delete_entry_index" name="index" value="Placeholder">
        <div class="floating_content">
          <div class="floating_text">Willst du den Zeiteintrag wirklich löschen?</div>
        </div>
        <button class="button card_button red" type="submit">
          <img src="{% static 'imgs/delete_icon_round_red.png' %}" alt="Delete" draggable="false">
          <div><p>Löschen</p></div>
        </button>
      </form>
    </div>
  </div>
  <!-- DELETE ENTRIES -->
  <div class="floating_container" id="floating_window_delete_entries">
    <div class="floating_window">
      <div class="floating_header">
        <h1>Daten löschen</h1>
        <div class="floating_close_button" onclick="closeFloatingWindows()">
          <img src="{% static 'imgs/close_icon.png' %}" alt="Close window" draggable="false">
        </div>
      </div>
      <form action="" method="post">
        {% csrf_token %}
        <input type="hidden" name="context" value="delete_entries">
        <div class="floating_content">
          <div class="floating_text">Willst du den aufgenommenen Arbeitsbericht wirklich löschen?</div>
        </div>
        <button class="button card_button red" type="submit">
          <img src="{% static 'imgs/delete_icon_round_red.png' %}" alt="Delete" draggable="false">
          <div><p>Löschen</p></div>
        </button>
      </form>
    </div>
  </div>
  <!-- NAVBAR -->
  <div class="navbar_hide_button" onclick="toggleNavbar()">
    <img id="navbar_hide_button_img" src="{% static 'imgs/menu_icon.png' %}" alt="Open menu" draggable="false">
  </div>
  <div class="navbar" id="navbar">
    <div class="navbar_header">
      <img src="{% static 'imgs/logo.png' %}" alt="DVM Planner Logo" draggable="false">
      <p>DVM Planner</p>
    </div>
    <ul>
      <li><a class="navbar_item highlighted"><div>Dashboard</div></a></li>
      <li><a class="navbar_item" href="/reports/"><div>Arbeitsberichte</div></a></li>
      <li><a class="navbar_item" href="/review/"><div>Ergebnisse</div></a></li>
      {% if role == 'admin' %}
        <li><a class="navbar_item" href="/admin/"><div>Admin Dashboard</div></a></li>
      {% endif %}
      <li><a class="navbar_item" href="/profile/"><div>Profil</div></a></li>
    </ul>
    <a class="button navbar_add_button small_text" href="/addreport/">
      <img src="{% static 'imgs/add_icon_round_red.png' %}" alt="Add report" draggable="false">
      <div><p>Bericht hinzufügen</p></div>
    </a>
  </div>
  <!-- CONTENT -->
  <div class="content" id="content">
    <div class="topbar">
      <div class="topbar_text">Hallo {{ first_name }} {{ last_name }}</div>
      <div class="button profile_button" id="profile_button">
        {% if img == True %}
          <img src="{% static 'profiles/' %}{{uid}}.png" alt="Profile picture of {{uid}}" draggable="false">
        {% else %}
          <img src="{% static 'profiles/' %}_default.png" alt="Default profile picture" draggable="false">
        {% endif %}
        <div><p>{{ username }}</p></div>
      </div>
    </div>
    <div class="usermenu hidden_usermenu" id="usermenu">
      <a class="button usermenu_button" href="/login/">
        <img src="{% static 'imgs/change_user_icon_round.png' %}" alt="Change user" draggable="false">
        <div><p>Profil wechseln</p></div>
      </a>
      <a class="button usermenu_button" href="/signup/">
        <img src="{% static 'imgs/logout_icon_round.png' %}" alt="Logout" draggable="false">
        <div><p>Ausloggen</p></div>
      </a>
    </div>
    <!-- DASHBOARD -->
    <!-- CHECK-IN REPORT -->
    <div class="card">
      <h1>Neuer Arbeitsbericht</h1>
      <div class="wrapped_content">
        {% if current_activity.status == 'none' %}
          <form action="" method="post">
            {% csrf_token %}
            <input type="hidden" name="context" value="start_report">
            <button class="button card_button green" type="submit">
              <img src="{% static 'imgs/start_icon_round_green.png' %}" alt="Start" draggable="false">
              <div><p>Starten</p></div>
            </button>
          </form>
        {% elif current_activity.status == 'active' %}
          <form action="" method="post">
            {% csrf_token %}
            <input type="hidden" name="context" value="pause_report">
            <button class="button card_button blue" type="submit">
              <img src="{% static 'imgs/pause_icon_round_blue.png' %}" alt="Pause" draggable="false">
              <div><p>Pause</p></div>
            </button>
          </form>
        {% elif current_activity.status == 'paused' %}
          <form action="" method="post">
            {% csrf_token %}
            <input type="hidden" name="context" value="resume_report">
            <button class="button card_button blue" type="submit">
              <img src="{% static 'imgs/start_icon_round_blue.png' %}" alt="Resume" draggable="false">
              <div><p>Fortfahren</p></div>
            </button>
          </form>
        {% endif %}
        {% if current_activity.status == 'active' or current_activity.status == 'paused' %}
          <form action="" method="post">
            {% csrf_token %}
            <input type="hidden" name="context" value="finish_report">
            <button class="button card_button red" type="submit">
              <img src="{% static 'imgs/finish_icon_round_red.png' %}" alt="Finish" draggable="false">
              <div><p>Beenden</p></div>
            </button>
          </form>
        {% endif %}
      </div>
      {% if current_activity.status == 'finished' %}
        <div>
          <h2>Arbeitsbericht beendet</h2>
          <p>Dein Arbeitsbericht wurde erfolgreich beendet. Du kannst nun die temporär gespeicherten Zeiten einsehen und bearbeiten sowie den Bericht abschließen.</p>
        </div>
      {% elif current_activity.status == 'paused' %}
        <p>Der aktuelle Arbeitsbericht wurde pausiert und alle bisherigen Zeiten temporär gespeichert.</p>
      {% endif %}
      {% if current_activity.status != 'none' %}
        <div class="space_top_1">
          <h2>Gespeicherte Zeiten des aktuellen Arbeitsberichts:</h2>
          <div class="border_item overflow">
            <table>
              <tr>
                <th>Tag</th>
                <th>Beginn</th>
                <th>Tag</th>
                <th>Ende</th>
                <th>Dauer</th>
                <th>Aktionen</th>
              </tr>
              {% for entry in current_activity.entries %}
                <tr class="hoverable_tr">
                  <td>{{ entry.day }}</td>
                  <td class="nowrap">{{ entry.start }}</td>
                  <td>{{ entry.end_day }}</td>
                  <td class="nowrap">{{ entry.end }}</td>
                  <td>{{ entry.time }}</td>
                  <td class="no_select">
                    <button class="table_button red tooltip_elem" onclick="deleteEntry('{{ forloop.counter0 }}')"><img src="{% static 'imgs/delete_icon.png' %}" alt="Delete" draggable="false"><div class="tooltip_text">Löschen</div></button>
                  </td>
                </tr>
              {% endfor %}
            </table>
          </div>
          <p>Bitte beachte: Alle aufgeführten Zeiten werden als einzelne Arbeitsberichte mit den jeweils gleichen Details (Modul und Notizen) abgespeichert!</p>
        </div>
        <div class="space_top_1">
          <h2>Details des aktuellen Arbeitsberichts festlegen:</h2>
          <form action="" method="post">
            {% csrf_token %}
            <input type="hidden" name="context" value="checkin_report">
            <input type="hidden" name="times" id="checkin_report_times" value="Placeholder">
            <div class="checkin_data">
              <div class="form_item">
                <div class="form_name">Modul</div>
                <div class="dropdown form_dropdown checkin_dropdown">
                  <div class="dropdown_button">
                    <div>{{ placeholder_module.index }} {{ placeholder_module.name }}</div>
                    <img src="{% static 'imgs/expand_dropdown.png' %}" alt="" draggable="false">
                  </div>
                  <input class="dropdown_input" type="hidden" name="module" value="{{ placeholder_module.index }}">
                  <div class="dropdown_content">
                    {% for modulegroup in modules %}
                      <div class="dropdown_item not_selectable">{{ modulegroup.index }} {{ modulegroup.name }}</div>
                      {% for module in modulegroup.modules %}
                        <div class="dropdown_item indent_1  not_selectable">{{ module.index }} {{ module.name }}</div>
                        {% for submodule in module.submodules %}
                          <div class="dropdown_item indent_2" onclick="formDropdownSelect(this, '{{ submodule.index }}')">{{ submodule.index }} {{ submodule.name }}</div>
                        {% endfor %}
                      {% endfor %}
                    {% endfor %}
                  </div>
                </div>
              </div>
              <div class="form_item">
                <div class="form_name">Notizen</div>
                <textarea name="notes" rows="4" cols="50" placeholder="Eine kleine Beschreibung der Tätigkeit..." required></textarea>
              </div>
            </div>
            <div class="wrapped_content space_top_1">
              <button class="button card_button" type="submit">
                <img src="{% static 'imgs/save_icon_round.png' %}" alt="Save report" draggable="false">
                <div><p>Speichern</p></div>
              </button>
              <button class="button card_button" type="button" onclick="deleteEntries()">
                <img src="{% static 'imgs/delete_icon_round.png' %}" alt="Delete entries" draggable="false">
                <div><p>Daten löschen</p></div>
              </button>
            </div>
          </form>
        </div>
      {% endif %}
    </div>
  </div>
</body>
</html>